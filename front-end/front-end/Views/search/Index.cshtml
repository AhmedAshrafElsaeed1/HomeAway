@model front_end.ViewModel.SearchViewModel

@{
    var results = Model?.Results ?? new List<front_end.ViewModel.SearchViewModel.RoomWithHotelAddress>();
}

<div class="search-layout">

    <!-- Sidebar Filters -->
    <aside class="sidebar-filter">
        <h3>Filters</h3>

        <form method="get" asp-controller="Search" asp-action="Index">

            <!-- Price Range -->
            <div class="filter-group">
                <h4>Price Range</h4>

                <input type="range"
                       class="form-range"
                       name="maxPrice"
                       id="priceRange"
                       min="0"
                       max="1000"
                       value="@(Model.MaxPrice == 0 ? 500 : Model.MaxPrice)" />

                <div class="range-display">
                    $0 - $<span id="priceLabel">
                        @(Model.MaxPrice == 0 ? 500 : Model.MaxPrice)
                    </span>
                </div>
            </div>

            <!-- Star Rating -->
            <div class="filter-group">
                <h4>Star Rating</h4>

                <div class="form-check d-flex align-items-center gap-2 mb-1">
                    <input class="form-check-input"
                           type="radio"
                           name="star"
                           value="5"
                           @(Model.StarRating == 5 ? "checked" : "") />
                    <label class="form-check-label">⭐⭐⭐⭐⭐</label>
                </div>

                <div class="form-check d-flex align-items-center gap-2 mb-1">
                    <input class="form-check-input"
                           type="radio"
                           name="star"
                           value="4"
                           @(Model.StarRating == 4 ? "checked" : "") />
                    <label class="form-check-label">⭐⭐⭐⭐ & up</label>
                </div>
            </div>

            <button class="btn btn-apply" type="submit">Apply Filters</button>

        </form>
    </aside>

    <!-- Results List -->
    <div class="results-list">

        <h2>
            @(results.Count) rooms found
            @if (!string.IsNullOrEmpty(Model?.Destination))
            {
                @: in @Model.Destination
            }
        </h2>

        @if (results.Any())
        {
            @foreach (var roomWrapper in results)
            {
                var room = roomWrapper.Room;
                var hotelAddress = roomWrapper.HotelAddress;

                <div class="hotel-result-card">

                    <!-- Room image -->
                    <img src="~/images/pic5.jpg" alt="Room Image">

                    <div class="info">
                        <!-- Room Number -->
                        <h3>Room @room.Number</h3>

                        <!-- Hotel Address -->
                        <p>Hotel: @hotelAddress</p>

                        <!-- Room Type -->
                        <p>
                            Type:
                            @{
                                string typeName = room.Type switch
                                {
                                    0 => "Single",
                                    1 => "Double",
                                    2 => "Triple",
                                    3 => "Quadruple",
                                    4 => "Penthouse",
                                    _ => "Unknown"
                                };
                            }
                            @typeName
                        </p>

                        <!-- Availability -->
                        <p>
                            Status:
                            @if (room.IsAvailable)
                            {
                                <span style="color: green;">Available</span>
                            }
                            else
                            {
                                <span style="color: red;">Not Available</span>
                            }
                        </p>

                        <!-- Price -->
                        <div class="rating">
                            Price: $@room.Price
                        </div>
                    </div>

                    <div class="price-action">
                        <a asp-controller="Reserve"
                           asp-action="Index"
                           asp-route-id="@room.Id"
                           class="btn btn-select">
                            Select Room
                        </a>
                    </div>

                </div>
            }
        }
        else
        {
            <p>No rooms found matching your search criteria.</p>
        }
    </div>
</div>

<!-- Price Range Live Update -->
<script>
    const priceRange = document.getElementById("priceRange");
    const priceLabel = document.getElementById("priceLabel");

    priceRange.addEventListener("input", () => {
        priceLabel.textContent = priceRange.value;
    });
</script>
